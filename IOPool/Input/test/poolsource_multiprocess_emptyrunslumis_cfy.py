# Reads in multiprocess mode a file with empty runs and lumis
# interspersed with runs and lumis with events

import FWCore.ParameterSet.Config as cms

process = cms.Process("TEST")

process.load("FWCore.Framework.test.cmsExceptionsFatal_cff")

process.maxEvents = cms.untracked.PSet(
    input = cms.untracked.int32(-1)
)

process.options = cms.untracked.PSet(multiProcesses=cms.untracked.PSet(
    maxChildProcesses=cms.untracked.int32(2),
    maxSequentialEventsPerChild=cms.untracked.uint32(1)))


process.source = cms.Source("PoolSource", fileNames = cms.untracked.vstring("file:multiprocess_test2.root"))

process.test = cms.EDAnalyzer('RunLumiEventAnalyzer',
    verbose = cms.untracked.bool(True),
    # for child process 0 this is 3 times number of event, beginLumi, beginRun, endLumi, endRun function calls
    expectedEndingIndex = cms.untracked.int32(420),
    # for child process 1 this is 3 times number of event, beginLumi, beginRun, endLumi, endRun function calls
    expectedEndingIndex1 = cms.untracked.int32(222),
    # for child process 0
    expectedRunLumiEvents = cms.untracked.vuint32(
        100, 0, 0,
        100, 1, 0,
        100, 1, 0,
        100, 2, 0,
        100, 2, 0,
        100, 3, 0,
        100, 3, 0,
        100, 0, 0,
        101, 0, 0,
        101, 1, 0,
        101, 1, 0,
        101, 2, 0,
        101, 2, 0,
        101, 3, 0,
        101, 3, 0,
        101, 0, 0,
        102, 0, 0,
        102, 1, 0,
        102, 1, 1,
        102, 1, 0,
        102, 2, 0,
        102, 2, 3,
        102, 2, 0,
        102, 3, 0,
        102, 3, 5,
        102, 3, 0,
        102, 0, 0,
        104, 0, 0,
        104, 1, 0,
        104, 1, 2,
        104, 1, 0,
        104, 2, 0,
        104, 2, 4,
        104, 2, 0,
        104, 0, 0,
        105, 0, 0,
        105, 1, 0,
        105, 1, 1,
        105, 1, 0,
        105, 0, 0,
        106, 0, 0,
        106, 1, 0,
        106, 1, 0,
        106, 2, 0,
        106, 2, 3,
        106, 2, 0,
        106, 0, 0,
        107, 0, 0,
        107, 1, 0,
        107, 1, 2,
        107, 1, 0,
        107, 2, 0,
        107, 2, 4,
        107, 2, 0,
        107, 0, 0,
        108, 0, 0,
        108, 1, 0,
        108, 1, 0,
        108, 2, 0,
        108, 2, 0,
        108, 3, 0,
        108, 3, 0,
        108, 0, 0,
        109, 0, 0,
        109, 1, 0,
        109, 1, 0,
        109, 2, 0,
        109, 2, 0,
        109, 3, 0,
        109, 3, 0,
        109, 0, 0,
        110, 0, 0,
        110, 1, 0,
        110, 1, 1,
        110, 1, 0,
        110, 2, 0,
        110, 2, 3,
        110, 2, 0,
        110, 0, 0
    ),
    # for child process 1
    expectedRunLumiEvents1 = cms.untracked.vuint32(
        102, 0, 0,
        102, 1, 0,
        102, 1, 2,
        102, 1, 0,
        102, 2, 0,
        102, 2, 4,
        102, 2, 0,
        102, 0, 0,
        103, 0, 0,
        103, 1, 0,
        103, 1, 0,
        103, 2, 0,
        103, 2, 0,
        103, 3, 0,
        103, 3, 0,
        103, 0, 0,
        104, 0, 0,
        104, 1, 0,
        104, 1, 1,
        104, 1, 0,
        104, 2, 0,
        104, 2, 3,
        104, 2, 0,
        104, 3, 0,
        104, 3, 5,
        104, 3, 0,
        104, 0, 0,
        105, 0, 0,
        105, 2, 0,
        105, 2, 0,
        105, 3, 0,
        105, 3, 5,
        105, 3, 0,
        105, 0, 0,
        106, 0, 0,
        106, 3, 0,
        106, 3, 0,
        106, 0, 0,
        107, 0, 0,
        107, 1, 0,
        107, 1, 1,
        107, 1, 0,
        107, 2, 0,
        107, 2, 3,
        107, 2, 0,
        107, 3, 0,
        107, 3, 5,
        107, 3, 0,
        107, 0, 0,
        110, 0, 0,
        110, 1, 0,
        110, 1, 2,
        110, 1, 0,
        110, 3, 0,
        110, 3, 0,
        110, 0, 0,
        111, 0, 0,
        111, 1, 0,
        111, 1, 0,
        111, 2, 0,
        111, 2, 0,
        111, 3, 0,
        111, 3, 0,
        111, 0, 0,
        112, 0, 0,
        112, 1, 0,
        112, 1, 0,
        112, 2, 0,
        112, 2, 3,
        112, 2, 0,
        112, 3, 0,
        112, 3, 5,
        112, 3, 0,
        112, 0, 0
    )
)

process.test.expectedRunLumiEvents.extend([
        112, 0, 0,
        112, 2, 0,
        112, 2, 4,
        112, 2, 0,
        112, 0, 0,
        113, 0, 0,
        113, 1, 0,
        113, 1, 0,
        113, 2, 0,
        113, 2, 0,
        113, 3, 0,
        113, 3, 0,
        113, 0, 0,
        114, 0, 0,
        114, 1, 0,
        114, 1, 0,
        114, 2, 0,
        114, 2, 0,
        114, 3, 0,
        114, 3, 0,
        114, 0, 0,
        115, 0, 0,
        115, 1, 0,
        115, 1, 0,
        115, 2, 0,
        115, 2, 0,
        115, 3, 0,
        115, 3, 0,
        115, 0, 0,
        116, 0, 0,
        116, 1, 0,
        116, 1, 0,
        116, 2, 0,
        116, 2, 0,
        116, 3, 0,
        116, 3, 0,
        116, 0, 0,
        117, 0, 0,
        117, 1, 0,
        117, 1, 0,
        117, 2, 0,
        117, 2, 0,
        117, 3, 0,
        117, 3, 0,
        117, 0, 0,
        118, 0, 0,
        118, 1, 0,
        118, 1, 0,
        118, 2, 0,
        118, 2, 0,
        118, 3, 0,
        118, 3, 0,
        118, 0, 0,
        119, 0, 0,
        119, 1, 0,
        119, 1, 0,
        119, 2, 0,
        119, 2, 0,
        119, 3, 0,
        119, 3, 0,
        119, 0, 0
])

process.path1 = cms.Path(process.test)
